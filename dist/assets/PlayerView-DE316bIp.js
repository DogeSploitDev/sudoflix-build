import{G as C,a9 as v,n as F,A as $,j as e,C as B,r as N,I as O,aj as U}from"./vendor-CRD5yWxp.js";import{e as G,i as T,g as W,f as V,s as _,c as M,d as K,h as q,M as z,E as g,j as y,k as P,a as S,b as w,P as E,B as u,l as R,L as H,m as L,u as J,n as Q,o as Y,p as X,q as Z,r as ee,t as ae,v as te,w as se,x as ne,y as re,z as ie,A as oe,C as de,D as b,S as le,F as ce}from"./index-bxoUcoqi.js";function me(n,a){return!!L().DISALLOWED_IDS.map(r=>r.split("-")).find(r=>n===r[1]&&a===r[0])}function pe(n){const{t:a}=C(),t=v(),r=F(),{error:i,value:c,loading:x}=$(async()=>{var A;const o=await G(),h=(o==null?void 0:o.success)&&T(o.version)&&o.allowed;if(h&&!o.hasPermission)throw new Error("extension-no-permission");const d=W();if(d&&!h)try{await V(d)}catch{throw new Error("failed-api-metadata")}else _([...M().listSources(),...M().listEmbeds()]);let m=null;try{if(!t.media)throw new Error("no media params");m=K(t.media)}catch{}if(!m)return null;if(me(m.id,m.type))throw new Error("dmca");let s=null;try{s=await q(m.type,m.id,t.season)}catch(p){if(p.status===404)return null;throw p}if(!s)return null;let f=t.episode;if(s.meta.type===z.SERIES){let p=s.meta.seasonData.episodes.find(D=>D.id===t.episode);p||(p=s.meta.seasonData.episodes[0]),f=p.id,(t.season!==s.meta.seasonData.id||t.episode!==p.id)&&r(`/media/${t.media}/${s.meta.seasonData.id}/${p.id}`,{replace:!0})}(A=n.onGetMeta)==null||A.call(n,s,f)},[]);return i&&i.message==="extension-no-permission"?e.jsx(g,{children:e.jsxs(y,{children:[e.jsx(P,{icon:S.WAND,children:a("player.metadata.extensionPermission.badge")}),e.jsx(w,{children:a("player.metadata.extensionPermission.title")}),e.jsx(E,{children:a("player.metadata.extensionPermission.text")}),e.jsx(u,{onClick:()=>{R({page:"PermissionGrant",redirectUrl:window.location.href})},theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.metadata.extensionPermission.button")})]})}):i&&i.message==="dmca"?e.jsx(g,{children:e.jsxs(y,{children:[e.jsx(P,{icon:S.DRAGON,children:a("player.metadata.dmca.badge")}),e.jsx(w,{children:a("player.metadata.dmca.title")}),e.jsx(E,{children:a("player.metadata.dmca.text")}),e.jsx(u,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.metadata.failed.homeButton")})]})}):i&&i.message==="failed-api-metadata"?e.jsx(g,{children:e.jsxs(y,{children:[e.jsx(P,{icon:S.WAND,children:a("player.metadata.failed.badge")}),e.jsx(w,{children:a("player.metadata.api.text")}),e.jsx(E,{children:a("player.metadata.api.title")}),e.jsx(u,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.metadata.failed.homeButton")})]})}):i?e.jsx(g,{children:e.jsxs(y,{children:[e.jsx(P,{icon:S.WAND,children:a("player.metadata.failed.badge")}),e.jsx(w,{children:a("player.metadata.failed.title")}),e.jsx(E,{children:a("player.metadata.failed.text")}),e.jsx(u,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.metadata.failed.homeButton")})]})}):!c&&!x?e.jsx(g,{children:e.jsxs(y,{children:[e.jsx(P,{icon:S.WAND,children:a("player.metadata.notFound.badge")}),e.jsx(w,{children:a("player.metadata.notFound.title")}),e.jsx(E,{children:a("player.metadata.notFound.text")}),e.jsx(u,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.metadata.notFound.homeButton")})]})}):e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(H,{})})})}function ue(n){const{t:a}=C(),t=J("error"),r=B(),[i,c]=N.useState("unknown"),x=F(),o=N.useMemo(()=>{const h=n.data;let d="";const m=Q();return d+=`URL - ${r.pathname}
`,d+=`API - ${m.length>0}

`,Object.values(h.sources).forEach(s=>{var f;d+=`${s.id}: ${s.status}
`,s.reason&&(d+=`${s.reason}
`),(f=s.error)!=null&&f.message?d+=`${s.error.name??"unknown"}: ${s.error.message}
`:s.error&&(d+=`${s.error.toString()}
`)}),d},[n,r]);return N.useEffect(()=>{Y().then(h=>{c(h)})},[a]),i==="disallowed"?e.jsx(g,{children:e.jsxs(y,{children:[e.jsx(P,{icon:S.LOCK,children:a("player.scraping.extensionFailure.badge")}),e.jsx(w,{children:a("player.scraping.extensionFailure.title")}),e.jsx(E,{children:e.jsx(O,{i18nKey:"player.scraping.extensionFailure.text",components:{bold:e.jsx("span",{className:"font-bold",style:{color:"#cfcfcf"}})}})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{href:"/",theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.scraping.extensionFailure.homeButton")}),e.jsx(u,{onClick:()=>{R({page:"PermissionGrant",redirectUrl:window.location.href})},theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.scraping.extensionFailure.enableExtension")})]})]})}):e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsx(P,{icon:S.WAND,children:a("player.scraping.notFound.badge")}),e.jsx(w,{children:a("player.scraping.notFound.title")}),e.jsx(E,{children:a("player.scraping.notFound.text")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{href:"/",theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.scraping.notFound.homeButton")}),e.jsx(u,{onClick:()=>x("/discover"),theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.scraping.notFound.discoverButton")})]}),e.jsx(u,{onClick:()=>t.show(),theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:a("player.scraping.notFound.detailsButton")})]}),o?e.jsx(X,{id:t.id,onClose:()=>t.hide(),error:o}):null]})}async function xe(){return!(!L().HAS_ONBOARDING||await Z()||ee.getState().proxySet||ae.getState().completed)}function he(n){const a=n??"";if(!!!a.match(/^\d+(:\d+)*$/))return null;const r=a.split(":").map(Number).reverse(),i=r[2]??0,c=Math.min(r[1]??0,59),x=Math.min(r[0]??0,c>0?59:1/0);return i*60*60+c*60+x}function fe(){const n=F(),a=v(),[t,r]=N.useState(null),[i]=te("t"),{status:c,playMedia:x,reset:o,setScrapeNotFound:h,shouldStartFromBeginning:d,setShouldStartFromBeginning:m}=se(),{setPlayerMeta:s,scrapeMedia:f}=ne(),A=re(),p=JSON.stringify({media:a.media,season:a.season,episode:a.episode});N.useEffect(()=>{o()},[p,o]);const D=N.useCallback(l=>{var j,I;(l==null?void 0:l.type)==="show"?n(`/media/${a.media}/${(j=l.season)==null?void 0:j.tmdbId}/${(I=l.episode)==null?void 0:I.tmdbId}`):n(`/media/${a.media}`)},[n,a]),k=N.useCallback(l=>{if(!l)return;let j;i&&(j=he(i)??void 0),x(ie(l),oe(l.stream.captions),l.sourceId,d?0:j),m(!1)},[x,i,d,m]);return e.jsxs(de,{backUrl:A,onMetaChange:D,children:[c===b.IDLE?e.jsx(pe,{onGetMeta:s}):null,c===b.SCRAPING&&f?e.jsx(le,{media:f,onResult:(l,j)=>{r({sourceOrder:j,sources:l}),h()},onGetStream:k}):null,c===b.SCRAPE_NOT_FOUND&&t?e.jsx(ue,{data:t}):null,c===b.PLAYBACK_ERROR?e.jsx(ce,{}):null]})}function ye(){const n=B(),{loading:a,error:t,value:r}=$(()=>xe());if(t)throw new Error("Failed to detect onboarding");return a?null:r?e.jsx(U,{replace:!0,to:{pathname:"/onboarding",search:`redirect=${encodeURIComponent(n.pathname)}`}}):e.jsx(fe,{})}export{ye as PlayerView,fe as RealPlayerView,ye as default};
//# sourceMappingURL=PlayerView-DE316bIp.js.map
